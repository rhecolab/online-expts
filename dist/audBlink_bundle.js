(()=>{"use strict";var t={d:(e,o)=>{for(var s in o)t.o(o,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:o[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>f});const o=new(window.AudioContext||window.webkitAudioContext),s={};async function n(t){for(const e of t){const t=`../../stimuli/snds/${e}.wav`,n=await fetch(t),h=await n.arrayBuffer();s[e]=await o.decodeAudioData(h)}console.log("sounds preloaded")}function h(t,e,n=!1){!0===n?$("#fix").text(""):$("#fix").text("+");const h=o.createBufferSource();h.buffer=s[t],h.connect(o.destination),h.start(e)}window.playSound=h,window.preloadSounds=n;let i=0,l=[],a=null,r=0,c=0,d=[],u={},_="";const f={startTask:async function(t){_=t;const e=function(t,e,o){let s=[];for(let n=0;n<o.length;n++)for(let h=0;h<t.length;h++)for(let i=0;i<e.length;i++)for(let l=0;l<2;l++)s.push({t1:t[h],t2:e[i],lag:o[n]});for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s}(["glide_up","glide_down"],["a1_sh","a2_sh","a8_sh","a9_sh"],[0,3,9]);d=function(t){let e=[],o=[];e=["h1_sh","h2_sh","h3_sh","h4_sh","h5_sh","h6_sh","h7_sh","h8_sh","h9_sh","h10_sh","i1_sh","i2_sh","i3_sh","i4_sh","i5_sh","i6_sh","i7_sh","i8_sh","i9_sh","i10_sh"];for(let s=0;s<t.length;s++){let n=[];const{t1:h,t2:i,lag:l}=t[s],a=Math.floor(5*Math.random())+1;for(let t=0;t<a;t++){const t=e[Math.floor(Math.random()*e.length)];n.push({stim:t,type:"d"})}n.push({stim:h,type:"t1"});for(let t=0;t<l;t++){const t=e[Math.floor(Math.random()*e.length)];n.push({stim:t,type:"d"})}n.push({stim:i,type:"t2"});for(let t=0;t<3;t++){const t=e[Math.floor(Math.random()*e.length)];n.push({stim:t,type:"d"})}o.push({trialNum:s,t1:h,t2:i,lag:l,stimOrder:n})}return o}(e),window.trials=e,c=window.trials.length,u=await n(["glide_up","glide_down","a1_sh","a2_sh","a8_sh","a9_sh","h1_sh","h2_sh","h3_sh","h4_sh","h5_sh","h6_sh","h7_sh","h8_sh","h9_sh","h10_sh","i1_sh","i2_sh","i3_sh","i4_sh","i5_sh","i6_sh","i7_sh","i8_sh","i9_sh","i10_sh"]),document.getElementById("startButton").addEventListener("click",()=>{document.getElementById("instrBox").style.display="none",document.getElementById("startButton").style.display="none",p(d[i])})}};function p(t){a=t,r=NaN;const e=t.stimOrder;let s=o.currentTime;for(let t=0;t<e.length;t++)h(e[t].stim,s),g(s),m(s+.3),s+=.6;const n=600*e.length;setTimeout(()=>collectResp(1,t),n)}function g(t){const e=1e3*(t-o.currentTime);setTimeout(()=>{$("#fix").text("+")},e)}function m(t){const e=1e3*(t-o.currentTime);setTimeout(()=>{$("#fix").text("")},e)}window.collectResp=function(t,e=null){const o=trials[i];console.log("t1",o.t1),console.log("t2",o.t2),console.log("lag",o.lag),1===t&&(new Date,r={t1_item:o.t1,t2_item:o.t2,lag:o.lag,resp1:"",resp2:""}),2===t&&null!==e&&(r.resp1=e),3===t&&null!==e&&(r.resp2=e),1===t&&($("#q1").show(),$("#q2").hide()),2===t&&($("#q1").hide(),$("#q2").show()),3===t&&(l.push(r),r=null,$("#q1, #q2").hide(),i++,i<c?p(d[i]):function(t){document.getElementById("exptBox").innerText="Task complete!",console.log("Subject ID:",t),console.log("Data:",l),function(t,e,o){const s=(new Date).toISOString().split("T")[0].replace(/-/g,""),n=`${t}_${e}_${s}`,h=Object.keys(o[0]);let i="sub,"+h.join(",")+",taskName\n";o.forEach(o=>{const s=h.map(t=>o[t]??"");i+=`${t},${s.join(",")},${e}\n`}),fetch("/save-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:n,csv:i})}).then(t=>t.text()).then(t=>console.log("saved",t)).catch(t=>console.error("error:",t))}(t,"audBlink",l)}(_))},window.ablink=e.default})();