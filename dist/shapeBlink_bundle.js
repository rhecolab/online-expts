(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function o(t,e,o,n,l,s){if(l<3)return;const a=2*Math.PI/l;t.beginPath();for(let s=0;s<l;s++){const l=e+n*Math.cos(s*a),i=o+n*Math.sin(s*a);0===s?t.moveTo(l,i):t.lineTo(l,i)}t.closePath(),t.fillStyle=s,t.fill()}function n(t,e,o,n,l,s="up"){let a,i;switch(s.toLowerCase()){case"up":a=Math.PI,i=2*Math.PI;break;case"down":a=0,i=Math.PI;break;case"left":a=.5*Math.PI,i=1.5*Math.PI;break;case"right":a=-.5*Math.PI,i=.5*Math.PI}t.beginPath(),t.arc(e,o,n,a,i),t.closePath(),t.fillStyle=l,t.fill()}t.r(e),t.d(e,{startTask:()=>m}),new(window.AudioContext||window.webkitAudioContext);const l=75;const s=150,a=50;let i,h=0,c=[],r=null,f=0,u=0,g=[],d="";function m(t){d=t;const e=function(t,e,o){let n=[];for(let l=0;l<o.length;l++)for(let s=0;s<t.length;s++)for(let a=0;a<e.length;a++)for(let i=0;i<2;i++)n.push({t1:t[s],t2:e[a],lag:o[l]});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}return n}(["circle","square","triangle","pentagon"],["semiup","semidown","semileft","semiright"],[0,3,9]);g=function(t){let e=[],o=[];e=["h1_sh","h2_sh","h3_sh","h4_sh","h5_sh","h6_sh","h7_sh","h8_sh","h9_sh","h10_sh","i1_sh","i2_sh","i3_sh","i4_sh","i5_sh","i6_sh","i7_sh","i8_sh","i9_sh","i10_sh"];for(let n=0;n<t.length;n++){let l=[];const{t1:s,t2:a,lag:i}=t[n],h=Math.floor(5*Math.random())+1;for(let t=0;t<h;t++){const t=e[Math.floor(Math.random()*e.length)];l.push({stim:t,type:"d"})}l.push({stim:s,type:"t1"});for(let t=0;t<i;t++){const t=e[Math.floor(Math.random()*e.length)];l.push({stim:t,type:"d"})}l.push({stim:a,type:"t2"});for(let t=0;t<3;t++){const t=e[Math.floor(Math.random()*e.length)];l.push({stim:t,type:"d"})}o.push({trialNum:n,t1:s,t2:a,lag:i,stimOrder:l})}return o}(e),window.trials=e,u=window.trials.length,document.getElementById("startButton").addEventListener("click",()=>{document.getElementById("instrBox").style.display="none",document.getElementById("startButton").style.display="none",p(g[h])})}function p(t){r=t;let e=0;f=NaN;const h=t.stimOrder;function c(){if(e<h.length){const t=h[e];console.log(t),function(t){let e;console.log(t.stim,t.type),e="t1"===t.type?"white":"black",function(t,e,s,a,i){switch(t){case"star":!function(t,e,o,n,l,s,a){if(!t)return;let i=Math.PI/2*3,h=Math.PI/5;t.beginPath(),t.moveTo(e,o-l);for(let n=0;n<5;n++)t.lineTo(e+Math.cos(i)*l,o+Math.sin(i)*l),i+=h,t.lineTo(e+Math.cos(i)*s,o+Math.sin(i)*s),i+=h;t.lineTo(e,o-l),t.closePath(),t.fillStyle=a,t.fill()}(e,s,a,0,l/2,l/4,i);break;case"circle":!function(t,e,o,n,l){t&&(t.beginPath(),t.arc(e,o,n,0,2*Math.PI),t.fillStyle=l,t.fill(),t.closePath())}(e,s,a,l/2,i);break;case"square":!function(t,e,o,n,l){t&&(t.fillStyle=l,t.fillRect(e,o,n,n))}(e,s-l/2,a-l/2,l,i);break;case"triangle":!function(t,e,o,n,l){if(!t)return;const s=Math.sqrt(3)/2*n;t.beginPath(),t.moveTo(e,o),t.lineTo(e+n,o),t.lineTo(e+n/2,o-s),t.closePath(),t.fillStyle=l,t.fill()}(e,s-l/2,a+l/2,l,i);break;case"hexagon":o(e,s,a,l/2,6,i);break;case"pentagon":o(e,s,a,l/2,5,i);break;case"octagon":o(e,s,a,l/2,8,i);break;case"semiup":n(e,s,a,l/2,i,"up");break;case"semidown":n(e,s,a,l/2,i,"down");break;case"semileft":n(e,s,a,l/2,i,"left");break;case"semiright":n(e,s,a,l/2,i,"right")}}(t.stim,i,i.canvas.width/2,i.canvas.height/2,e)}(t),e++,setTimeout(u,s)}else collectResp(1,t)}function u(){i.clearRect(0,0,i.canvas.width,i.canvas.height),setTimeout(c,a)}c()}window.collectResp=function(t,e=null){const o=trials[h];console.log("t1",o.t1),console.log("t2",o.t2),console.log("lag",o.lag),1===t&&(f={t1_item:o.t1,t2_item:o.t2,lag:o.lag,resp1:"",resp2:""}),2===t&&null!==e&&(f.resp1=e),3===t&&null!==e&&(f.resp2=e),1===t&&($("#q1").show(),$("#q2").hide()),2===t&&($("#q1").hide(),$("#q2").show()),3===t&&(c.push(f),f=null,$("#q1, #q2").hide(),h++,h<u?p(g[h]):function(t){document.getElementById("exptBox").innerText="Task complete!",console.log("Subject ID:",t),console.log("Data:",c),function(t,e,o){const n=(new Date).toISOString().split("T")[0].replace(/-/g,""),l=`${t}_${e}_${n}`,s=Object.keys(o[0]);let a="sub,"+s.join(",")+",taskName\n";o.forEach(o=>{const n=s.map(t=>o[t]??"");a+=`${t},${n.join(",")},${e}\n`}),fetch("/save-results",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:l,csv:a})}).then(t=>t.text()).then(t=>console.log("saved",t)).catch(t=>console.error("error:",t))}(t,"shapeBlink",c)}(d))},window.sblink=e})();